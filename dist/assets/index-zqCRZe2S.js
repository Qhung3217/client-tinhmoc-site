import{eI as B,eJ as H,r as c,f4 as ve,f5 as E,f6 as be,eK as ye,j as e,B as I,h,aF as ne,I as u,c as Ce,e as _,n as F,w as $,cx as L,d8 as w,T as R,db as q,aX as te,cw as re,f as we,t as g,ap as ae,aZ as ie,dk as ke,aV as Ie,b2 as Se,dj as le,f7 as Re,aP as ce,au as de,cz as K,cy as he,aw as S,p as Y,e8 as J,dc as Te,d9 as Ne,ei as Ae,f8 as Le,dA as Oe,a$ as $e,b3 as De,ac as Me,cY as Ee,l as xe,H as Fe}from"./index-DBDTQgzR.js";import{E as Ue}from"./empty-content-CrThrvhQ.js";import{u as D}from"./use-mocked-user-Bgkpo3xo.js";import{L as U}from"./ListItemButton-CoHjNt7Q.js";import{A as ue}from"./AvatarGroup-DbGsAKHO.js";import{L as M}from"./ListItemText-BWLBNFBh.js";import{M as A}from"./MenuItem-CXtkif-l.js";import{S as C}from"./Skeleton-ClMJhwxT.js";import{C as We}from"./CircularProgress-27YVWvuS.js";import{S as me}from"./search-not-found-CAvx5TG6.js";import{I as ze}from"./InputAdornment-Bkememc_.js";import{C as Pe}from"./ClickAwayListener-BbJWI6yy.js";import{D as Ge}from"./dialogTitleClasses-dlJ2Dc6b.js";import{D as Ve}from"./DialogContent-Dc9_4vKy.js";import{F as Be}from"./file-thumbnail-NlKfSiYl.js";import{u as He,L as _e}from"./use-light-box-Cn1L5wfJ.js";import{u as ee}from"./uuidv4-B4SGT1yQ.js";import"./listItemButtonClasses-D6WOaO0u.js";import"./listItemTextClasses-YBd3Kn_2.js";import"./index-DixO9l5f.js";const V=!1,T=ye.chat,X={revalidateIfStale:V,revalidateOnFocus:V,revalidateOnReconnect:V};function qe(){const s=[T,{params:{endpoint:"contacts"}}],{data:o,isLoading:i,error:a,isValidating:t}=B(s,H,X);return c.useMemo(()=>({contacts:(o==null?void 0:o.contacts)||[],contactsLoading:i,contactsError:a,contactsValidating:t,contactsEmpty:!i&&!(o!=null&&o.contacts.length)}),[o==null?void 0:o.contacts,a,i,t])}function Ke(){const s=[T,{params:{endpoint:"conversations"}}],{data:o,isLoading:i,error:a,isValidating:t}=B(s,H,X);return c.useMemo(()=>{const n=o!=null&&o.conversations.length?ve(o.conversations,"id"):{},l=Object.keys(n);return{conversations:{byId:n,allIds:l},conversationsLoading:i,conversationsError:a,conversationsValidating:t,conversationsEmpty:!i&&!l.length}},[o==null?void 0:o.conversations,a,i,t])}function Ye(s){const o=s?[T,{params:{conversationId:s,endpoint:"conversation"}}]:"",{data:i,isLoading:a,error:t,isValidating:r}=B(o,H,X);return c.useMemo(()=>({conversation:i==null?void 0:i.conversation,conversationLoading:a,conversationError:t,conversationValidating:r}),[i==null?void 0:i.conversation,t,a,r])}async function Je(s,o){const i=[T,{params:{endpoint:"conversations"}}];E([T,{params:{conversationId:s,endpoint:"conversation"}}],t=>{const r=t.conversation,n={...r,messages:[...r.messages,o]};return{...t,conversation:n}},!1),E(i,t=>{const n=t.conversations.map(l=>l.id===s?{...l,messages:[...l.messages,o]}:l);return{...t,conversations:n}},!1)}async function Xe(s){const o=[T,{params:{endpoint:"conversations"}}],i={conversationData:s},a=await be.post(T,i);return E(o,t=>{const n=[...t.conversations,s];return{...t,conversations:n}},!1),a.data}async function Ze(s){E([T,{params:{endpoint:"conversations"}}],o=>{const a=o.conversations.map(t=>t.id===s?{...t,unreadCount:0}:t);return{...o,conversations:a}},!1)}function Qe({slots:s,sx:o,...i}){const a=e.jsx(I,{display:"flex",flexDirection:"column",children:s.nav}),t=e.jsx(h,{direction:"row",alignItems:"center",sx:{py:1,pr:1,pl:2.5,height:72,flexShrink:0,borderBottom:l=>`solid 1px ${l.vars.palette.divider}`},children:s.header}),r=e.jsx(h,{sx:{flex:"1 1 auto",minWidth:0},children:s.main}),n=e.jsx(h,{sx:{minHeight:0},children:s.details});return e.jsxs(h,{direction:"row",sx:o,...i,children:[a,e.jsxs(h,{sx:{flex:"1 1 auto",minWidth:0},children:[t,e.jsxs(h,{direction:"row",sx:{flex:"1 1 auto",minHeight:0},children:[r,n]})]})]})}const Z=ne(({selected:s,children:o,disabled:i,...a})=>e.jsxs(U,{disabled:i,...a,children:[o,e.jsx(u,{width:16,icon:(!s||i)&&"eva:arrow-ios-forward-fill"||"eva:arrow-ios-downward-fill"})]}))(({theme:s})=>({...s.typography.overline,height:40,paddingLeft:s.spacing(2.5),justifyContent:"space-between",paddingRight:s.spacing(1.5),color:s.vars.palette.text.secondary,backgroundColor:s.vars.palette.background.neutral})),es=ne(Ce)(({theme:s})=>({top:84,left:0,zIndex:9,width:32,height:32,position:"absolute",borderRadius:"0 12px 12px 0",boxShadow:s.customShadows.primary,color:s.vars.palette.primary.contrastText,backgroundColor:s.vars.palette.primary.main,transition:s.transitions.create(["all"],{duration:s.transitions.duration.shorter}),"&:hover":{backgroundColor:s.vars.palette.primary.darker}}));function ss({currentUserId:s,conversation:o}){const{messages:i,participants:a}=o,t=a.filter(x=>x.id!==s),r=i[i.length-1],n=t.length>1,l=t.map(x=>x.name).join(", "),d=n?t.map(x=>x.status).includes("online"):!1;let m="";if(r){const x=r.senderId===s?"You: ":"",p=r.contentType==="image"?"Sent a photo":r.body;m=`${x}${p}`}return{group:n,displayName:l,displayText:m,participants:t,lastActivity:r.createdAt,hasOnlineInGroup:d}}function os({selected:s,collapse:o,conversation:i,onCloseMobile:a}){const{user:t}=D(),r=_("up","md"),n=F(),{group:l,displayName:d,displayText:m,participants:x,lastActivity:p,hasOnlineInGroup:j}=ss({conversation:i,currentUserId:`${t==null?void 0:t.id}`}),v=x[0],{name:f,avatarUrl:b,status:y}=v,W=c.useCallback(async()=>{try{r||a(),await Ze(i.id),n.push(`${$.dashboard.chat}?id=${i.id}`)}catch(N){console.error(N)}},[i.id,r,a,n]),z=e.jsx(L,{variant:j?"online":"invisible",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ue,{variant:"compact",sx:{width:48,height:48},children:x.slice(0,2).map(N=>e.jsx(w,{alt:N.name,src:N.avatarUrl},N.id))})}),O=e.jsx(L,{variant:y,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(w,{alt:f,src:b,sx:{width:48,height:48}})},y);return e.jsx(I,{component:"li",sx:{display:"flex"},children:e.jsxs(U,{onClick:W,sx:{py:1.5,px:2.5,gap:2,...s&&{bgcolor:"action.selected"}},children:[e.jsx(L,{color:"error",overlap:"circular",badgeContent:o?i.unreadCount:0,children:l?z:O}),!o&&e.jsxs(e.Fragment,{children:[e.jsx(M,{primary:d,primaryTypographyProps:{noWrap:!0,component:"span",variant:"subtitle2"},secondary:m,secondaryTypographyProps:{noWrap:!0,component:"span",variant:i.unreadCount?"subtitle2":"body2",color:i.unreadCount?"text.primary":"text.secondary"}}),e.jsxs(h,{alignItems:"flex-end",sx:{alignSelf:"stretch"},children:[e.jsx(R,{noWrap:!0,variant:"body2",component:"span",sx:{mb:1.5,fontSize:12,color:"text.disabled"},children:q(p)}),!!i.unreadCount&&e.jsx(I,{sx:{width:8,height:8,bgcolor:"info.main",borderRadius:"50%"}})]})]})]})})}function ns(){var r;const{user:s}=D(),o=te(),[i,a]=c.useState("online"),t=c.useCallback(n=>{a(n.target.value)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(L,{variant:i,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(w,{src:s==null?void 0:s.photoURL,alt:s==null?void 0:s.displayName,onClick:o.onOpen,sx:{cursor:"pointer",width:48,height:48},children:(r=s==null?void 0:s.displayName)==null?void 0:r.charAt(0).toUpperCase()})}),e.jsxs(re,{open:o.open,anchorEl:o.anchorEl,onClose:o.onClose,slotProps:{paper:{sx:{p:0}},arrow:{placement:"top-left"}},children:[e.jsxs(h,{direction:"row",alignItems:"center",spacing:2,sx:{py:2,pr:1,pl:2},children:[e.jsx(M,{primary:s==null?void 0:s.displayName,secondary:s==null?void 0:s.email,secondaryTypographyProps:{component:"span"}}),e.jsx(we,{title:"Log out",children:e.jsx(g,{color:"error",children:e.jsx(u,{icon:"ic:round-power-settings-new"})})})]}),e.jsx(ae,{sx:{borderStyle:"dashed"}}),e.jsxs(ie,{sx:{my:.5,px:.5},children:[e.jsxs(A,{children:[e.jsx(L,{variant:i,sx:{[`& .${ke.badge}`]:{m:.75,width:12,height:12,flexShrink:0,position:"static"}}}),e.jsx(Ie,{fullWidth:!0,children:e.jsx(Se,{native:!0,fullWidth:!0,value:i,onChange:t,input:e.jsx(le,{}),inputProps:{id:"chat-status-select",sx:{textTransform:"capitalize"}},sx:{[`& .${Re.root}`]:{right:0}},children:["online","alway","busy","offline"].map(n=>e.jsx("option",{value:n,children:n},n))})})]}),e.jsxs(A,{children:[e.jsx(u,{icon:"solar:user-id-bold",width:24}),"Profile"]}),e.jsxs(A,{children:[e.jsx(u,{icon:"eva:settings-2-fill",width:24}),"Settings"]})]})]})]})}function ts({sx:s,amount:o=6,...i}){return[...Array(o)].map((a,t)=>e.jsxs(h,{spacing:2,direction:"row",alignItems:"center",sx:{px:2.5,py:1.5,...s},...i,children:[e.jsx(C,{variant:"circular",sx:{width:48,height:48}}),e.jsxs(h,{spacing:1,flexGrow:1,children:[e.jsx(C,{sx:{width:.75,height:10}}),e.jsx(C,{sx:{width:.5,height:10}})]})]},t))}function rs({sx:s,...o}){return e.jsxs(h,{direction:"row",alignItems:"center",sx:{width:1,...s},...o,children:[e.jsx(C,{variant:"circular",sx:{width:40,height:40}}),e.jsxs(h,{spacing:1,flexGrow:1,sx:{mx:2},children:[e.jsx(C,{sx:{width:96,height:10}}),e.jsx(C,{sx:{width:40,height:10}})]}),e.jsx(C,{variant:"circular",sx:{width:28,height:28}}),e.jsx(C,{variant:"circular",sx:{width:28,height:28,mx:1}}),e.jsx(C,{variant:"circular",sx:{width:28,height:28,mr:1}})]})}function as({sx:s,...o}){return e.jsx(h,{flexGrow:1,sx:{pt:5,...s},...o,children:e.jsxs(h,{alignItems:"center",children:[e.jsx(C,{variant:"circular",sx:{width:96,height:96}}),e.jsx(C,{sx:{mb:1,mt:2,height:10,width:.65}}),e.jsx(C,{sx:{width:.35,height:10,mb:5}}),e.jsx(We,{color:"inherit",thickness:2})]})})}function is({query:s,results:o,onClickResult:i}){const a=o.length,t=!a&&!!s,r=e.jsx(me,{query:s,sx:{p:3,mx:"auto",width:"calc(100% - 40px)",bgcolor:"background.neutral"}}),n=e.jsx("nav",{children:e.jsx(I,{component:"ul",children:o.map(l=>e.jsx(I,{component:"li",sx:{display:"flex"},children:e.jsxs(U,{onClick:()=>i(l),sx:{gap:2,py:1.5,px:2.5,typography:"subtitle2"},children:[e.jsx(w,{alt:l.name,src:l.avatarUrl}),l.name]})},l.id))})});return e.jsxs(e.Fragment,{children:[e.jsxs(R,{variant:"h6",sx:{px:2.5,mb:2},children:["Contacts (",a,")"]}),t?r:n]})}const se=320,ls=96;function cs({loading:s,contacts:o,conversations:i,collapseNav:a,selectedConversationId:t}){const r=ce(),n=F(),l=_("up","md"),{openMobile:d,onOpenMobile:m,onCloseMobile:x,onCloseDesktop:p,collapseDesktop:j,onCollapseDesktop:v}=a,[f,b]=c.useState({query:"",results:[]});c.useEffect(()=>{l||p()},[p,l]);const y=c.useCallback(()=>{l?v():x()},[l,x,v]),W=c.useCallback(()=>{l||x(),n.push($.dashboard.chat)},[l,x,n]),z=c.useCallback(k=>{if(b(P=>({...P,query:k})),k){const P=o.filter(G=>G.name.toLowerCase().includes(k));b(G=>({...G,results:P}))}},[o]),O=c.useCallback(()=>{b({query:"",results:[]})},[]),N=c.useCallback(k=>{O(),n.push(`${$.dashboard.chat}?id=${k.id}`)},[O,n]),pe=e.jsx(ts,{}),ge=e.jsx("nav",{children:e.jsx(I,{component:"ul",children:i.allIds.map(k=>e.jsx(os,{collapse:j,conversation:i.byId[k],selected:k===t,onCloseMobile:x},k))})}),je=e.jsx(is,{query:f.query,results:f.results,onClickResult:N}),fe=e.jsx(Pe,{onClickAway:O,children:e.jsx(de,{fullWidth:!0,value:f.query,onChange:k=>z(k.target.value),placeholder:"Search contacts...",InputProps:{startAdornment:e.jsx(ze,{position:"start",children:e.jsx(u,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},sx:{mt:2.5}})}),Q=e.jsxs(e.Fragment,{children:[e.jsxs(h,{direction:"row",alignItems:"center",justifyContent:"center",sx:{p:2.5,pb:0},children:[!j&&e.jsxs(e.Fragment,{children:[e.jsx(ns,{}),e.jsx(I,{sx:{flexGrow:1}})]}),e.jsx(g,{onClick:y,children:e.jsx(u,{icon:j?"eva:arrow-ios-forward-fill":"eva:arrow-ios-back-fill"})}),!j&&e.jsx(g,{onClick:W,children:e.jsx(u,{width:24,icon:"solar:user-plus-bold"})})]}),e.jsx(I,{sx:{p:2.5,pt:0},children:!j&&fe}),s?pe:e.jsx(K,{sx:{pb:1},children:f.query&&i.allIds.length?je:ge})]});return e.jsxs(e.Fragment,{children:[e.jsx(es,{onClick:m,sx:{display:{md:"none"}},children:e.jsx(u,{width:16,icon:"solar:users-group-rounded-bold"})}),e.jsx(h,{sx:{minHeight:0,flex:"1 1 auto",width:se,display:{xs:"none",md:"flex"},borderRight:`solid 1px ${r.vars.palette.divider}`,transition:r.transitions.create(["width"],{duration:r.transitions.duration.shorter}),...j&&{width:ls}},children:Q}),e.jsx(he,{open:d,onClose:x,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:se}},children:Q})]})}function ds({participant:s,open:o,onClose:i}){return e.jsxs(Ge,{fullWidth:!0,maxWidth:"xs",open:o,onClose:i,children:[e.jsx(g,{onClick:i,sx:{position:"absolute",right:8,top:8},children:e.jsx(u,{icon:"mingcute:close-line"})}),e.jsxs(Ve,{sx:{py:5,px:3,display:"flex"},children:[e.jsx(w,{alt:s.name,src:s.avatarUrl,sx:{width:96,height:96,mr:3}}),e.jsxs(h,{spacing:1,children:[e.jsx(R,{variant:"caption",sx:{color:"primary.main"},children:s.role}),e.jsx(R,{variant:"subtitle1",children:s.name}),e.jsxs(h,{direction:"row",sx:{typography:"caption",color:"text.disabled"},children:[e.jsx(u,{icon:"mingcute:location-fill",width:16,sx:{flexShrink:0,mr:.5,mt:"2px"}}),s.address]}),e.jsxs(h,{spacing:1,direction:"row",sx:{pt:1.5},children:[e.jsx(g,{size:"small",color:"error",sx:{borderRadius:1,bgcolor:a=>S(a.vars.palette.error.mainChannel,.08),"&:hover":{bgcolor:a=>S(a.vars.palette.error.mainChannel,.16)}},children:e.jsx(u,{width:18,icon:"solar:phone-bold"})}),e.jsx(g,{size:"small",color:"info",sx:{borderRadius:1,bgcolor:a=>S(a.vars.palette.info.mainChannel,.08),"&:hover":{bgcolor:a=>S(a.vars.palette.info.mainChannel,.16)}},children:e.jsx(u,{width:18,icon:"solar:chat-round-dots-bold"})}),e.jsx(g,{size:"small",color:"primary",sx:{borderRadius:1,bgcolor:a=>S(a.vars.palette.primary.mainChannel,.08),"&:hover":{bgcolor:a=>S(a.vars.palette.primary.mainChannel,.16)}},children:e.jsx(u,{width:18,icon:"fluent:mail-24-filled"})}),e.jsx(g,{size:"small",color:"secondary",sx:{borderRadius:1,bgcolor:a=>S(a.vars.palette.secondary.mainChannel,.08),"&:hover":{bgcolor:a=>S(a.vars.palette.secondary.mainChannel,.16)}},children:e.jsx(u,{width:18,icon:"solar:videocamera-record-bold"})})]})]})]})]})}function hs({participants:s}){const o=Y(!0),[i,a]=c.useState(null),t=c.useCallback(d=>{a(d)},[]),r=c.useCallback(()=>{a(null)},[]),n=s.length,l=e.jsx(e.Fragment,{children:s.map(d=>e.jsxs(U,{onClick:()=>t(d),children:[e.jsx(L,{variant:d.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(w,{alt:d.name,src:d.avatarUrl})}),e.jsx(M,{sx:{ml:2},primary:d.name,secondary:d.role,primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{noWrap:!0,component:"span",typography:"caption"}})]},d.id))});return e.jsxs(e.Fragment,{children:[e.jsx(Z,{selected:o.value,disabled:!n,onClick:o.onToggle,children:`In room (${n})`}),e.jsx(J,{in:o.value,children:l}),i&&e.jsx(ds,{participant:i,open:!!i,onClose:r})]})}function xs({participant:s}){const o=Y(!0),i=e.jsxs(h,{alignItems:"center",sx:{py:5},children:[e.jsx(w,{alt:s==null?void 0:s.name,src:s==null?void 0:s.avatarUrl,sx:{width:96,height:96,mb:2}}),e.jsx(R,{variant:"subtitle1",children:s==null?void 0:s.name}),e.jsx(R,{variant:"body2",sx:{color:"text.secondary",mt:.5},children:s==null?void 0:s.role})]}),a=e.jsx(h,{spacing:2,sx:{px:2,py:2.5},children:[{icon:"mingcute:location-fill",value:s==null?void 0:s.address},{icon:"solar:phone-bold",value:s==null?void 0:s.phoneNumber},{icon:"fluent:mail-24-filled",value:s==null?void 0:s.email}].map(t=>e.jsxs(h,{spacing:1,direction:"row",sx:{typography:"body2",wordBreak:"break-all"},children:[e.jsx(u,{icon:t.icon,sx:{flexShrink:0,color:"text.disabled"}}),t.value]},t.icon))});return e.jsxs(e.Fragment,{children:[i,e.jsx(Z,{selected:o.value,onClick:o.onToggle,children:"Information"}),e.jsx(J,{in:o.value,children:a})]})}function us({attachments:s}){const o=Y(!0),i=s.length,a=s.map((t,r)=>e.jsxs(h,{spacing:1.5,direction:"row",alignItems:"center",children:[e.jsx(Be,{imageView:!0,file:t.preview,onDownload:()=>console.info("DOWNLOAD"),slotProps:{icon:{width:24,height:24}},sx:{width:40,height:40,bgcolor:"background.neutral"}}),e.jsx(M,{primary:t.name,secondary:Te(t.createdAt),primaryTypographyProps:{noWrap:!0,typography:"body2"},secondaryTypographyProps:{mt:.25,noWrap:!0,component:"span",typography:"caption",color:"text.disabled"}})]},t.name+r));return e.jsxs(e.Fragment,{children:[e.jsx(Z,{selected:o.value,disabled:!i,onClick:o.onToggle,children:`Attachments (${i})`}),!!i&&e.jsx(J,{in:o.value,children:e.jsx(h,{spacing:2,sx:{p:2},children:a})})]})}const ms=280,ps=320;function gs({collapseNav:s,participants:o,messages:i,loading:a}){const t=ce(),{collapseDesktop:r,openMobile:n,onCloseMobile:l}=s,d=o.length>1,m=i.map(p=>p.attachments).flat(1)||[],x=a?e.jsx(as,{}):e.jsx(K,{children:e.jsxs("div",{children:[d?e.jsx(hs,{participants:o}):e.jsx(xs,{participant:o[0]}),e.jsx(us,{attachments:m})]})});return e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{minHeight:0,flex:"1 1 auto",width:ms,display:{xs:"none",lg:"flex"},borderLeft:`solid 1px ${t.vars.palette.divider}`,transition:t.transitions.create(["width"],{duration:t.transitions.duration.shorter}),...r&&{width:0}},children:!r&&x}),e.jsx(he,{anchor:"right",open:n,onClose:l,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:ps}},children:x})]})}function js({message:s,participants:o,currentUserId:i}){const a=o.find(l=>l.id===s.senderId),t=s.senderId===i?{type:"me"}:{avatarUrl:a==null?void 0:a.avatarUrl,firstName:a==null?void 0:a.name.split(" ")[0]},r=t.type==="me";return{hasImage:s.contentType==="image",me:r,senderDetails:t}}function fs({message:s,participants:o,onOpenLightbox:i}){const{user:a}=D(),{me:t,senderDetails:r,hasImage:n}=js({message:s,participants:o,currentUserId:`${a==null?void 0:a.id}`}),{firstName:l,avatarUrl:d}=r,{body:m,createdAt:x}=s,p=e.jsxs(R,{noWrap:!0,variant:"caption",sx:{mb:1,color:"text.disabled",...!t&&{mr:"auto"}},children:[!t&&`${l}, `,q(x)]}),j=e.jsx(h,{sx:{p:1.5,minWidth:48,maxWidth:320,borderRadius:1,typography:"body2",bgcolor:"background.neutral",...t&&{color:"grey.800",bgcolor:"primary.lighter"},...n&&{p:0,bgcolor:"transparent"}},children:n?e.jsx(I,{component:"img",alt:"attachment",src:m,onClick:()=>i(m),sx:{width:400,height:"auto",borderRadius:1.5,cursor:"pointer",objectFit:"cover",aspectRatio:"16/11","&:hover":{opacity:.9}}}):m}),v=e.jsxs(h,{direction:"row",className:"message-actions",sx:{pt:.5,left:0,opacity:0,top:"100%",position:"absolute",transition:f=>f.transitions.create(["opacity"],{duration:f.transitions.duration.shorter}),...t&&{right:0,left:"unset"}},children:[e.jsx(g,{size:"small",children:e.jsx(u,{icon:"solar:reply-bold",width:16})}),e.jsx(g,{size:"small",children:e.jsx(u,{icon:"eva:smiling-face-fill",width:16})}),e.jsx(g,{size:"small",children:e.jsx(u,{icon:"solar:trash-bin-trash-bold",width:16})})]});return e.jsxs(h,{direction:"row",justifyContent:t?"flex-end":"unset",sx:{mb:5},children:[!t&&e.jsx(w,{alt:l,src:d,sx:{width:32,height:32,mr:2}}),e.jsxs(h,{alignItems:t?"flex-end":"flex-start",children:[p,e.jsxs(h,{direction:"row",alignItems:"center",sx:{position:"relative","&:hover":{"& .message-actions":{opacity:1}}},children:[j,v]})]})]})}function vs(s){const o=c.useRef(null),i=c.useCallback(()=>{s&&o.current&&o.current&&(o.current.scrollTop=o.current.scrollHeight)},[s]);return c.useEffect(()=>{i()},[s]),{messagesEndRef:o}}function bs({messages:s=[],participants:o,loading:i}){const{messagesEndRef:a}=vs(s),t=s.filter(n=>n.contentType==="image").map(n=>({src:n.body})),r=He(t);return i?e.jsx(h,{sx:{flex:"1 1 auto",position:"relative"},children:e.jsx(Ne,{color:"inherit",sx:{top:0,left:0,width:1,height:2,borderRadius:0,position:"absolute"}})}):e.jsxs(e.Fragment,{children:[e.jsx(K,{ref:a,sx:{px:3,pt:5,pb:3,flex:"1 1 auto"},children:s.map(n=>e.jsx(fs,{message:n,participants:o,onOpenLightbox:()=>r.onOpen(n.body)},n.id))}),e.jsx(_e,{slides:t,open:r.open,close:r.onClose,index:r.selected})]})}function ys({disabled:s,recipients:o,onAddRecipients:i,selectedConversationId:a}){const t=F(),{user:r}=D(),n=c.useRef(null),[l,d]=c.useState(""),m=c.useMemo(()=>({id:`${r==null?void 0:r.id}`,role:`${r==null?void 0:r.role}`,email:`${r==null?void 0:r.email}`,address:`${r==null?void 0:r.address}`,name:`${r==null?void 0:r.displayName}`,lastActivity:Ae(),avatarUrl:`${r==null?void 0:r.photoURL}`,phoneNumber:`${r==null?void 0:r.phoneNumber}`,status:"online"}),[r]),x=c.useMemo(()=>({id:ee(),attachments:[],body:l,contentType:"text",createdAt:Le({minutes:1}),senderId:m.id}),[l,m.id]),p=c.useMemo(()=>({id:ee(),messages:[x],participants:[...o,m],type:o.length>1?"GROUP":"ONE_TO_ONE",unreadCount:0}),[x,m,o]),j=c.useCallback(()=>{n.current&&n.current.click()},[]),v=c.useCallback(b=>{d(b.target.value)},[]),f=c.useCallback(async b=>{try{if(b.key==="Enter"){if(l)if(a)await Je(a,x);else{const y=await Xe(p);t.push(`${$.dashboard.chat}?id=${y.conversation.id}`),i([])}d("")}}catch(y){console.error(y)}},[p,l,x,i,t,a]);return e.jsxs(e.Fragment,{children:[e.jsx(le,{name:"chat-message",id:"chat-message-input",value:l,onKeyUp:f,onChange:v,placeholder:"Type a message",disabled:s,startAdornment:e.jsx(g,{children:e.jsx(u,{icon:"eva:smiling-face-fill"})}),endAdornment:e.jsxs(h,{direction:"row",sx:{flexShrink:0},children:[e.jsx(g,{onClick:j,children:e.jsx(u,{icon:"solar:gallery-add-bold"})}),e.jsx(g,{onClick:j,children:e.jsx(u,{icon:"eva:attach-2-fill"})}),e.jsx(g,{children:e.jsx(u,{icon:"solar:microphone-bold"})})]}),sx:{px:1,height:56,flexShrink:0,borderTop:b=>`solid 1px ${b.vars.palette.divider}`}}),e.jsx("input",{type:"file",ref:n,style:{display:"none"}})]})}function Cs({collapseNav:s,participants:o,loading:i}){const a=te(),t=_("up","lg"),r=o.length>1,n=o[0],{collapseDesktop:l,onCollapseDesktop:d,onOpenMobile:m}=s,x=c.useCallback(()=>{t?d():m()},[t]),p=e.jsx(ue,{max:3,sx:{[`& .${Oe.avatar}`]:{width:32,height:32}},children:o.map(v=>e.jsx(w,{alt:v.name,src:v.avatarUrl},v.id))}),j=e.jsxs(h,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(L,{variant:n==null?void 0:n.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(w,{src:n==null?void 0:n.avatarUrl,alt:n==null?void 0:n.name})}),e.jsx(M,{primary:n==null?void 0:n.name,secondary:(n==null?void 0:n.status)==="offline"?q(n==null?void 0:n.lastActivity):n==null?void 0:n.status,secondaryTypographyProps:{component:"span",...(n==null?void 0:n.status)!=="offline"&&{textTransform:"capitalize"}}})]});return i?e.jsx(rs,{}):e.jsxs(e.Fragment,{children:[r?p:j,e.jsxs(h,{direction:"row",flexGrow:1,justifyContent:"flex-end",children:[e.jsx(g,{children:e.jsx(u,{icon:"solar:phone-bold"})}),e.jsx(g,{children:e.jsx(u,{icon:"solar:videocamera-record-bold"})}),e.jsx(g,{onClick:x,children:e.jsx(u,{icon:l?"ri:sidebar-fold-fill":"ri:sidebar-unfold-fill"})}),e.jsx(g,{onClick:a.onOpen,children:e.jsx(u,{icon:"eva:more-vertical-fill"})})]}),e.jsx(re,{open:a.open,anchorEl:a.anchorEl,onClose:a.onClose,children:e.jsxs(ie,{children:[e.jsxs(A,{onClick:()=>{a.onClose()},children:[e.jsx(u,{icon:"solar:bell-off-bold"}),"Hide notifications"]}),e.jsxs(A,{onClick:()=>{a.onClose()},children:[e.jsx(u,{icon:"solar:forbidden-circle-bold"}),"Block"]}),e.jsxs(A,{onClick:()=>{a.onClose()},children:[e.jsx(u,{icon:"solar:danger-triangle-bold"}),"Report"]}),e.jsx(ae,{sx:{borderStyle:"dashed"}}),e.jsxs(A,{onClick:()=>{a.onClose()},sx:{color:"error.main"},children:[e.jsx(u,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})})]})}function ws({contacts:s,onAddRecipients:o}){const[i,a]=c.useState(""),t=c.useCallback(r=>{a(""),o(r)},[o]);return e.jsxs(e.Fragment,{children:[e.jsx(R,{variant:"subtitle2",sx:{color:"text.primary",mr:2},children:"To:"}),e.jsx($e,{sx:{minWidth:{md:320},flexGrow:{xs:1,md:"unset"}},multiple:!0,limitTags:3,popupIcon:null,defaultValue:[],disableCloseOnSelect:!0,noOptionsText:e.jsx(me,{query:i}),onChange:(r,n)=>t(n),onInputChange:(r,n)=>a(n),options:s,getOptionLabel:r=>r.name,isOptionEqualToValue:(r,n)=>r.id===n.id,renderInput:r=>e.jsx(de,{...r,placeholder:"+ Recipients"}),renderOption:(r,n,{selected:l})=>c.createElement("li",{...r,key:n.id},e.jsxs(I,{sx:{mr:1,width:32,height:32,overflow:"hidden",borderRadius:"50%",position:"relative"},children:[e.jsx(w,{alt:n.name,src:n.avatarUrl,sx:{width:1,height:1}}),e.jsx(h,{alignItems:"center",justifyContent:"center",sx:{top:0,left:0,width:1,height:1,opacity:0,position:"absolute",bgcolor:d=>S(d.vars.palette.grey["900Channel"],.8),transition:d=>d.transitions.create(["opacity"],{easing:d.transitions.easing.easeInOut,duration:d.transitions.duration.shorter}),...l&&{opacity:1,color:"primary.main"}},children:e.jsx(u,{icon:"eva:checkmark-fill"})})]},n.id),n.name),renderTags:(r,n)=>r.map((l,d)=>c.createElement(De,{...n({index:d}),key:l.id,label:l.name,avatar:e.jsx(w,{alt:l.name,src:l.avatarUrl}),size:"small",variant:"soft"}))})]})}function oe(){const[s,o]=c.useState(!1),[i,a]=c.useState(!1),t=c.useCallback(()=>{a(d=>!d)},[]),r=c.useCallback(()=>{a(!1)},[]),n=c.useCallback(()=>{o(!0)},[]),l=c.useCallback(()=>{o(!1)},[]);return{collapseDesktop:i,onCloseDesktop:r,onCollapseDesktop:t,openMobile:s,onOpenMobile:n,onCloseMobile:l}}function ks(){const s=F(),{user:o}=D(),{contacts:i}=qe(),t=Me().get("id")||"",[r,n]=c.useState([]),{conversations:l,conversationsLoading:d}=Ke(),{conversation:m,conversationError:x,conversationLoading:p}=Ye(`${t}`),j=oe(),v=oe(),f=m?m.participants.filter(y=>y.id!==`${o==null?void 0:o.id}`):[];c.useEffect(()=>{(x||!t)&&s.push($.dashboard.chat)},[x,s,t]);const b=c.useCallback(y=>{n(y)},[]);return e.jsxs(Ee,{maxWidth:!1,sx:{display:"flex",flex:"1 1 auto",flexDirection:"column"},children:[e.jsx(R,{variant:"h4",sx:{mb:{xs:3,md:5}},children:"Chat"}),e.jsx(Qe,{sx:{minHeight:0,flex:"1 1 0",borderRadius:2,position:"relative",bgcolor:"background.paper",boxShadow:y=>y.customShadows.card},slots:{header:t?e.jsx(Cs,{collapseNav:j,participants:f,loading:p}):e.jsx(ws,{contacts:i,onAddRecipients:b}),nav:e.jsx(cs,{contacts:i,conversations:l,loading:d,selectedConversationId:t,collapseNav:v}),main:e.jsxs(e.Fragment,{children:[t?e.jsx(bs,{messages:(m==null?void 0:m.messages)??[],participants:f,loading:p}):e.jsx(Ue,{imgUrl:`${xe.site.basePath}/assets/icons/empty/ic-chat-active.svg`,title:"Good morning!",description:"Write something awesome..."}),e.jsx(ys,{recipients:r,onAddRecipients:b,selectedConversationId:t,disabled:!r.length&&!t})]}),details:t&&e.jsx(gs,{collapseNav:j,participants:f,loading:p,messages:(m==null?void 0:m.messages)??[]})}})]})}const Is={title:`Chat | Dashboard - ${xe.site.name}`};function _s(){return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{children:e.jsxs("title",{children:[" ",Is.title]})}),e.jsx(ks,{})]})}export{_s as default};
