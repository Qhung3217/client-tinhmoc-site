import{K as r,aV as ss,a as i,aW as es,aX as z,aY as N,aZ as D,a_ as as,ao as is,X as ls,j as e,ai as ms,F as h,T as I}from"./index-CWahQ5ZS.js";import{z as a,u as V,t as k,F as m,a as T,L as ns}from"./form-provider-CaIsVnSA.js";import{L as ts}from"./index-CbZhzOjM.js";import"./image-Ds2WO9mA.js";import{C as hs}from"./Card-C6GOi25m.js";import{C as os}from"./CardHeader-DunmSz8L.js";const gs=a.object({title:a.string().min(1,{message:"Tên sản phẩm là bắt buộc!"}),content:a.string().min(1,{message:"Mô tả sản phẩm là bắt buộc!"}),price:a.string(),salePercent:a.number(),priority:a.number(),thumbnail:a.string(),slug:a.string().min(1,{message:"Mã sản phẩm là bắt buộc!"}),categoryId:a.string()}),bs=a.object({thumb:a.union([a.string(),a.instanceof(File)])}),ps=a.object({thumb:a.union([a.string(),a.instanceof(File)])}),xs=a.object({images:a.array(a.union([a.string(),a.instanceof(File)]))});function Is({currentProduct:s,mutate:G}){const U=r(),{categories:g,categoriesLoading:W}=ss(),o=i.useMemo(()=>({title:(s==null?void 0:s.title)||"",content:(s==null?void 0:s.content)||"",thumbnail:(s==null?void 0:s.thumbnail)||"",link3d:(s==null?void 0:s.link3d)||"",slug:(s==null?void 0:s.slug)||"",price:(s==null?void 0:s.price)||"",salePercent:(s==null?void 0:s.salePercent)||0,priority:(s==null?void 0:s.priority)||0,categoryId:typeof(s==null?void 0:s.categoryId)=="string"?s==null?void 0:s.categoryId:g.length>0?g[0].categories[0].id:""}),[s,g]),L=i.useMemo(()=>({thumb:(s==null?void 0:s.thumbnail)||""}),[s]),R=i.useMemo(()=>({thumb:(s==null?void 0:s.link3d)||""}),[s]),M=i.useMemo(()=>({images:(s==null?void 0:s.images)||[]}),[s]),b=V({mode:"all",resolver:k(gs),defaultValues:o}),p=V({mode:"all",resolver:k(bs),defaultValues:L}),x=V({mode:"all",resolver:k(ps),defaultValues:R}),d=V({mode:"all",resolver:k(xs),defaultValues:M});i.useEffect(()=>{b.reset(o),p.reset(L),x.reset(R),d.reset(M)},[s,M,L,R,o,d,b,p,x]);const{reset:S,watch:H,setValue:F,handleSubmit:X,formState:{isSubmitting:B}}=b,A=H(),{watch:J,setValue:j}=p,E=J(),{watch:K,setValue:f}=x,C=K(),{watch:Y,setValue:v}=d,w=Y();i.useEffect(()=>{F("categoryId",A.categoryId,{shouldValidate:!0})},[F,A.categoryId]),i.useEffect(()=>{s&&S(o)},[s,o,S]);const Z=X(async n=>{try{const l=w.images.filter(t=>t instanceof File),y=w.images.filter(t=>typeof t=="string");if(console.log("DATA after upload",n),s)await as(s.id,n),await z(s.id,E.thumb),await N(s.id,C.thumb),await D(s.id,l,y);else{const t=await es(n);await z(t.id,E.thumb),await N(t.id,C.thumb),await D(t.id,l,y)}console.log(C.thumb),S(),is.success(s?"Chỉnh sửa thành công!":"Thêm thành công!"),U.push(ls.dashboard.product.root),G()}catch(l){console.error(l)}}),_=i.useCallback(()=>{j("thumb","",{shouldValidate:!0})},[j]),q=i.useCallback(()=>{j("thumb","",{shouldValidate:!0})},[j]),O=i.useCallback(()=>{f("thumb","",{shouldValidate:!0})},[f]),Q=i.useCallback(()=>{f("thumb","",{shouldValidate:!0})},[f]),$=i.useCallback(n=>{const l=w.images.filter(y=>y!==n);v("images",l)},[v,w.images]),c=i.useCallback(()=>{v("images",[],{shouldValidate:!0})},[v]),u=e.jsxs(hs,{children:[e.jsx(os,{title:"Thông tin sản phẩm",subheader:"Mã sản phẩm, Tên sản phẩm, Mô tả, Ảnh bìa...",sx:{mb:3}}),e.jsx(ms,{}),e.jsxs(h,{spacing:3,sx:{p:3},children:[e.jsx(m.Text,{name:"slug",label:"Mã sản phẩm *"}),e.jsx(m.Text,{name:"title",label:"Tên sản phẩm *"}),e.jsx(m.Text,{type:"number",name:"priority",label:"Độ ưu tiên"}),e.jsx(m.Text,{name:"price",label:"Giá sản phẩm"}),e.jsx(m.Text,{type:"number",name:"salePercent",label:"Giảm giá"}),e.jsxs(h,{spacing:1.5,children:[e.jsx(I,{variant:"subtitle2",children:"Mô tả *"}),e.jsx(m.Editor,{name:"content",sx:{maxHeight:480}})]}),e.jsxs(h,{spacing:1.5,children:[e.jsx(I,{variant:"subtitle2",children:"Ảnh bìa"}),e.jsx(T,{methods:p,children:e.jsx(m.Upload,{thumbnail:!0,name:"thumb",maxSize:3145728,onRemove:_,onRemoveAll:q})})]}),e.jsxs(h,{spacing:1.5,children:[e.jsx(I,{variant:"subtitle2",children:"Ảnh mô tả"}),e.jsx(T,{methods:d,children:e.jsx(m.Upload,{multiple:!0,thumbnail:!0,name:"images",maxSize:3145728,onRemove:$,onRemoveAll:c})})]}),e.jsxs(h,{spacing:1.5,children:[e.jsx(I,{variant:"subtitle2",children:"Ảnh 3D"}),e.jsx(T,{methods:x,children:e.jsx(m.Upload,{name:"thumb",maxSize:18e8,accept:{"application/octet-stream":[".fbx",".glb"]},onRemove:O,onRemoveAll:Q})})]}),W?e.jsx(ts,{}):e.jsx(m.Select,{native:!0,name:"categoryId",label:"Loại sản phẩm",InputLabelProps:{shrink:!0},children:g.map(n=>e.jsx("optgroup",{label:n.name,children:n.categories.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))},n.name))})]})]}),P=e.jsx(h,{spacing:3,direction:"row",alignItems:"center",flexWrap:"wrap",children:e.jsx(ns,{type:"submit",variant:"contained",size:"large",loading:B,children:s?"Lưu thay đổi":"Thêm sản phẩm"})});return e.jsx(T,{methods:b,onSubmit:Z,children:e.jsxs(h,{spacing:{xs:3,md:5},sx:{mx:"auto",maxWidth:{xs:720,xl:880}},children:[u,P]})})}export{Is as P};
