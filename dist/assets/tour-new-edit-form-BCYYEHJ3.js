import{cI as P,n as U,r as o,cM as N,w as R,j as e,h as t,ap as j,T as m,e_ as I,d8 as v,b3 as f,eW as L,eH as M,b0 as V}from"./index-CZQdhxL6.js";import{z as l,u as z,t as H,a as W,F as d}from"./form-provider-CgY9D6Kg.js";import"./image-BKqVmPzF.js";import"./editor-CDG2HKGW.js";import{s as x}from"./schema-helper-B-83MGJ7.js";import{C as D}from"./Card-BpNMtBWE.js";import{C as S}from"./CardHeader-OkCeJUez.js";import{F as B}from"./FormControlLabel-BkPFkiPo.js";import{L as J}from"./LoadingButton-CHo-zp-G.js";const G=l.object({name:l.string().min(1,{message:"Name is required!"}),content:x.editor({message:{required_error:"Content is required!"}}),images:x.files({message:{required_error:"Images is required!"}}),tourGuides:l.array(l.object({id:l.string(),name:l.string(),avatarUrl:l.string(),phoneNumber:l.string()})).nonempty({message:"Must have at least 1 guide!"}),available:l.object({startDate:x.date({message:{required_error:"Start date is required!"}}),endDate:x.date({message:{required_error:"End date is required!"}})}),durations:l.string().min(1,{message:"Durations is required!"}),destination:x.objectOrNull({message:{required_error:"Destination is required!"}}),services:l.string().array().min(2,{message:"Must have at least 2 items!"}),tags:l.string().array().min(2,{message:"Must have at least 2 items!"})}).refine(a=>!P(a.available.startDate,a.available.endDate),{message:"End date cannot be earlier than start date!",path:["available.endDate"]});function ae({currentTour:a}){const C=U(),p=o.useMemo(()=>({name:(a==null?void 0:a.name)||"",content:(a==null?void 0:a.content)||"",images:(a==null?void 0:a.images)||[],tourGuides:(a==null?void 0:a.tourGuides)||[],available:{startDate:(a==null?void 0:a.available.startDate)||null,endDate:(a==null?void 0:a.available.endDate)||null},durations:(a==null?void 0:a.durations)||"",destination:(a==null?void 0:a.destination)||"",services:(a==null?void 0:a.services)||[],tags:(a==null?void 0:a.tags)||[]}),[a]),b=z({mode:"all",resolver:H(G),defaultValues:p}),{watch:E,reset:c,setValue:h,handleSubmit:y,formState:{isSubmitting:k}}=b,g=E();o.useEffect(()=>{a&&c(p)},[a,p,c]);const q=y(async i=>{try{await new Promise(s=>setTimeout(s,500)),c(),N.success(a?"Update success!":"Create success!"),C.push(R.dashboard.tour.root),console.info("DATA",i)}catch(s){console.error(s)}}),w=o.useCallback(i=>{var n;const s=g.images&&((n=g.images)==null?void 0:n.filter(r=>r!==i));h("images",s,{shouldValidate:!0})},[h,g.images]),A=o.useCallback(()=>{h("images",[],{shouldValidate:!0})},[h]),O=e.jsxs(D,{children:[e.jsx(S,{title:"Details",subheader:"Title, short description, image...",sx:{mb:3}}),e.jsx(j,{}),e.jsxs(t,{spacing:3,sx:{p:3},children:[e.jsxs(t,{spacing:1.5,children:[e.jsx(m,{variant:"subtitle2",children:"Name"}),e.jsx(d.Text,{name:"name",placeholder:"Ex: Adventure Seekers Expedition..."})]}),e.jsxs(t,{spacing:1.5,children:[e.jsx(m,{variant:"subtitle2",children:"Content"}),e.jsx(d.Editor,{name:"content",sx:{maxHeight:480}})]}),e.jsxs(t,{spacing:1.5,children:[e.jsx(m,{variant:"subtitle2",children:"Images"}),e.jsx(d.Upload,{multiple:!0,thumbnail:!0,name:"images",maxSize:3145728,onRemove:w,onRemoveAll:A,onUpload:()=>console.info("ON UPLOAD")})]})]})]}),_=e.jsxs(D,{children:[e.jsx(S,{title:"Properties",subheader:"Additional functions and attributes...",sx:{mb:3}}),e.jsx(j,{}),e.jsxs(t,{spacing:3,sx:{p:3},children:[e.jsxs("div",{children:[e.jsx(m,{variant:"subtitle2",sx:{mb:1.5},children:"Tour guide"}),e.jsx(d.Autocomplete,{multiple:!0,name:"tourGuides",placeholder:"+ Tour Guides",disableCloseOnSelect:!0,options:I,getOptionLabel:i=>i.name,isOptionEqualToValue:(i,s)=>i.id===s.id,renderOption:(i,s)=>o.createElement("li",{...i,key:s.id},e.jsx(v,{alt:s.avatarUrl,src:s.avatarUrl,sx:{mr:1,width:24,height:24,flexShrink:0}},s.id),s.name),renderTags:(i,s)=>i.map((n,r)=>o.createElement(f,{...s({index:r}),key:n.id,size:"small",variant:"soft",label:n.name,avatar:e.jsx(v,{alt:n.name,src:n.avatarUrl})}))})]}),e.jsxs(t,{spacing:1.5,children:[e.jsx(m,{variant:"subtitle2",children:"Available"}),e.jsxs(t,{direction:{xs:"column",md:"row"},spacing:2,children:[e.jsx(d.DatePicker,{name:"available.startDate",label:"Start date"}),e.jsx(d.DatePicker,{name:"available.endDate",label:"End date"})]})]}),e.jsxs(t,{spacing:1.5,children:[e.jsx(m,{variant:"subtitle2",children:"Duration"}),e.jsx(d.Text,{name:"durations",placeholder:"Ex: 2 days, 4 days 3 nights..."})]}),e.jsxs(t,{spacing:1.5,children:[e.jsx(m,{variant:"subtitle2",children:"Destination"}),e.jsx(d.CountrySelect,{fullWidth:!0,name:"destination",placeholder:"+ Destination"})]}),e.jsxs(t,{spacing:1,children:[e.jsx(m,{variant:"subtitle2",children:"Services"}),e.jsx(d.MultiCheckbox,{name:"services",options:L,sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)"}})]}),e.jsxs(t,{spacing:1.5,children:[e.jsx(m,{variant:"subtitle2",children:"Tags"}),e.jsx(d.Autocomplete,{name:"tags",placeholder:"+ Tags",multiple:!0,freeSolo:!0,disableCloseOnSelect:!0,options:M.map(i=>i),getOptionLabel:i=>i,renderOption:(i,s)=>o.createElement("li",{...i,key:s},s),renderTags:(i,s)=>i.map((n,r)=>o.createElement(f,{...s({index:r}),key:n,label:n,size:"small",color:"info",variant:"soft"}))})]})]})]}),F=e.jsxs(t,{direction:"row",alignItems:"center",flexWrap:"wrap",children:[e.jsx(B,{control:e.jsx(V,{defaultChecked:!0,inputProps:{id:"publish-switch"}}),label:"Publish",sx:{flexGrow:1,pl:3}}),e.jsx(J,{type:"submit",variant:"contained",size:"large",loading:k,sx:{ml:2},children:a?"Save changes":"Create tour"})]});return e.jsx(W,{methods:b,onSubmit:q,children:e.jsxs(t,{spacing:{xs:3,md:5},sx:{mx:"auto",maxWidth:{xs:720,xl:880}},children:[O,_,F]})})}export{ae as T};
