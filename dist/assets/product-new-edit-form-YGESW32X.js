import{n as X,dP as Y,r as l,dQ as Z,dR as A,dS as E,dT as _,cM as $,w as c,j as e,ap as u,h,T as w}from"./index-u4c5uTy0.js";import{z as a,u as V,t as M,F as n,a as S}from"./form-provider-Bg5v_u9U.js";import{a9 as r}from"./index-CxQHrayw.js";import"./image-I9HL7nG0.js";import"./editor-Dm0D5q3G.js";import{C as P}from"./Card-Ro7Utuy1.js";import{C as ss}from"./CardHeader-CNvgM0Ym.js";import{L as es}from"./LoadingButton-B1VX3ihL.js";const as=a.object({title:a.string().min(1,{message:"Tên sản phẩm là bắt buộc!"}),content:a.string().min(1,{message:"Mô tả sản phẩm là bắt buộc!"}),price:a.string(),salePercent:a.number(),priority:a.number(),thumbnail:a.string(),slug:a.string().min(1,{message:"Mã sản phẩm là bắt buộc!"}),categoryId:a.string()}),is=a.object({thumb:a.union([a.string(),a.instanceof(File)])}),ls=a.object({images:a.array(a.union([a.string(),a.instanceof(File)]))});function xs({currentProduct:s,mutate:L}){const k=X(),{categories:g,categoriesLoading:z}=Y(),o=l.useMemo(()=>({title:(s==null?void 0:s.title)||"",content:(s==null?void 0:s.content)||"",thumbnail:(s==null?void 0:s.thumbnail)||"",slug:(s==null?void 0:s.slug)||"",price:(s==null?void 0:s.price)||"",salePercent:(s==null?void 0:s.salePercent)||0,priority:(s==null?void 0:s.priority)||0,categoryId:typeof(s==null?void 0:s.categoryId)=="string"?s==null?void 0:s.categoryId:g.length>0?g[0].categories[0].id:""}),[s,g]),y=l.useMemo(()=>({thumb:(s==null?void 0:s.thumbnail)||""}),[s]),I=l.useMemo(()=>({images:(s==null?void 0:s.images)||[]}),[s]),p=V({mode:"all",resolver:M(as),defaultValues:o}),b=V({mode:"all",resolver:M(is),defaultValues:y}),x=V({mode:"all",resolver:M(ls),defaultValues:I});l.useEffect(()=>{p.reset(o),b.reset(y),x.reset(I)},[s,I,y,o,x,p,b]);const{reset:T,watch:N,setValue:R,handleSubmit:D,formState:{isSubmitting:G}}=p,C=N(),{watch:H,setValue:d}=b,F=H(),{watch:U,setValue:f}=x,j=U();l.useEffect(()=>{R("categoryId",C.categoryId,{shouldValidate:!0})},[R,C.categoryId]),l.useEffect(()=>{s&&T(o)},[s,o,T]);const W=D(async m=>{try{const i=j.images.filter(t=>t instanceof File),v=j.images.filter(t=>typeof t=="string");if(console.log("DATA after upload",m),s)await _(s.id,m),await A(s.id,F.thumb),await E(s.id,i,v);else{const t=await Z(m);await A(t.id,F.thumb),await E(t.id,i,v)}T(),$.success(s?"Chỉnh sửa thành công!":"Thêm thành công!"),k.push(c.dashboard.product.root),L()}catch(i){console.error(i)}}),B=l.useCallback(()=>{d("thumb","",{shouldValidate:!0})},[d]),J=l.useCallback(()=>{d("thumb","",{shouldValidate:!0})},[d]),Q=l.useCallback(m=>{const i=j.images.filter(v=>v!==m);f("images",i)},[f,j.images]),q=l.useCallback(()=>{f("images",[],{shouldValidate:!0})},[f]),K=e.jsxs(P,{children:[e.jsx(ss,{title:"Thông tin sản phẩm",subheader:"Mã sản phẩm, Tên sản phẩm, Mô tả, Ảnh bìa...",sx:{mb:3}}),e.jsx(u,{}),e.jsxs(h,{spacing:3,sx:{p:3},children:[e.jsx(n.Text,{name:"slug",label:"Mã sản phẩm *"}),e.jsx(n.Text,{name:"title",label:"Tên sản phẩm *"}),e.jsx(n.Text,{type:"number",name:"priority",label:"Độ ưu tiên"}),e.jsx(n.Text,{name:"price",label:"Giá sản phẩm"}),e.jsx(n.Text,{type:"number",name:"salePercent",label:"Giảm giá"}),e.jsxs(h,{spacing:1.5,children:[e.jsx(w,{variant:"subtitle2",children:"Mô tả *"}),e.jsx(n.Editor,{name:"content",sx:{maxHeight:480}})]}),e.jsxs(h,{spacing:1.5,children:[e.jsx(w,{variant:"subtitle2",children:"Ảnh bìa"}),e.jsx(S,{methods:b,children:e.jsx(n.Upload,{thumbnail:!0,name:"thumb",maxSize:3145728,onRemove:B,onRemoveAll:J})})]}),e.jsxs(h,{spacing:1.5,children:[e.jsx(w,{variant:"subtitle2",children:"Ảnh mô tả"}),e.jsx(S,{methods:x,children:e.jsx(n.Upload,{multiple:!0,thumbnail:!0,name:"images",maxSize:3145728,onRemove:Q,onRemoveAll:q})})]}),z?e.jsx(r,{}):e.jsx(n.Select,{native:!0,name:"categoryId",label:"Loại sản phẩm",InputLabelProps:{shrink:!0},children:g.map(m=>e.jsx("optgroup",{label:m.name,children:m.categories.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))},m.name))})]})]}),O=e.jsx(h,{spacing:3,direction:"row",alignItems:"center",flexWrap:"wrap",children:e.jsx(es,{type:"submit",variant:"contained",size:"large",loading:G,children:s?"Lưu thay đổi":"Thêm sản phẩm"})});return e.jsx(S,{methods:p,onSubmit:W,children:e.jsxs(h,{spacing:{xs:3,md:5},sx:{mx:"auto",maxWidth:{xs:720,xl:880}},children:[K,O]})})}export{xs as P};
